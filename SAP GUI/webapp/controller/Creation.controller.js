/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["hcm/fab/myleaverequest/utils/formatters","hcm/fab/myleaverequest/utils/utils","hcm/fab/myleaverequest/controller/BaseController","hcm/fab/myleaverequest/utils/DataUtil","hcm/fab/myleaverequest/utils/CalendarUtil","sap/ui/Device","sap/ui/core/routing/History","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Context","sap/ui/model/odata/type/Decimal","sap/ui/base/Event","sap/m/Label","sap/m/Input","sap/m/Title","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/m/MessageToast","sap/m/MessageBox","sap/m/ToolbarSpacer","sap/m/ProgressIndicator","sap/m/OverflowToolbar","sap/m/ObjectAttribute","sap/m/UploadCollection","sap/m/UploadCollectionItem","sap/m/UploadCollectionParameter","sap/ui/model/json/JSONModel","sap/ui/core/format/DateFormat","hcm/fab/lib/common/controls/TeamCalendarControl","hcm/fab/lib/common/util/DateUtil","sap/m/Dialog","sap/m/Button","sap/m/StandardListItem","sap/m/DateRangeSelection","sap/m/DatePicker"],function(f,u,B,D,C,a,H,F,b,c,d,E,L,I,T,M,e,g,h,j,P,O,k,U,l,m,J,n,o,q,r,s,S,t,v){"use strict";var w=5;var x=5;var y=["notes","AdditionalFields"];var z={"CompCode":{keyField:"CompanyCodeID",titleField:"CompanyCodeID",descriptionField:"CompanyCodeText",searchFields:"CompanyCodeID,CompanyCodeText"},"DescIllness":{keyField:"IllnessCode",titleField:"IllnessCode",descriptionField:"IllnessDescTxt",searchFields:"IllnessCode,IllnessDescTxt"},"CostCenter":{keyField:"CostCenterID",titleField:"CostCenterID",descriptionField:"CostCenterText",searchFields:"CostCenterID,CostCenterText"},"OtCompType":{keyField:"OverTimeCompID",titleField:"OverTimeCompID",descriptionField:"OverTimeCompText",searchFields:"OverTimeCompID,OverTimeCompText"},"TaxArea":{keyField:"WorkTaxAreaID",titleField:"WorkTaxAreaID",descriptionField:"WorkTaxAreaDesciption",searchFields:"WorkTaxAreaDesciption"},"ObjectType":{keyField:"ObjtypeID",titleField:"ObjtypeID",descriptionField:"ObjTypetext",searchFields:"ObjtypeID,ObjTypetext"},"WageType":{keyField:"WageTypeID",titleField:"WageTypeID",descriptionField:"WageTypeText",searchFields:"WageTypeID,WageTypeText"},"OrderID":{keyField:"OrderNumID",titleField:"OrderNumID",descriptionField:"OrderNumText",searchFields:"OrderNumID,OrderNumText"}};return B.extend("hcm.fab.myleaverequest.controller.Creation",{oCreateModel:null,sCEEmployeeId:undefined,formatter:f,utils:u,oUploadCollection:null,oUploadSet:null,_messagesPopover:null,_notesBuffer:null,_oMessagePopover:null,_oNewFileData:{},_oControlToFocus:null,_bCheckboxFieldsAreBoolean:false,_bApproverOnBehalfPropertyExists:false,_oSearchApproverItemTemplate:null,_bCheckLeaveSpanFIDateIsEdmTime:false,_bQuotaAvailabilityFIHasDateParams:false,onInit:function(){var i=this.getOwnerComponent(),R=i.getRouter();this._oAdditionalFieldsControls={};this._absenceTypeReceivedDeferred=u.createDeferred();R.getRoute("creation").attachPatternMatched(this._onCreateRouteMatched,this);R.getRoute("creationWithParams").attachPatternMatched(this._onCreateRouteMatched,this);R.getRoute("edit").attachPatternMatched(this._onEditRouteMatched,this);R.getRoute("delete").attachPatternMatched(this._onDeletePostedLeaveRouteMatched,this);this._oNotesModel=new J({NoteCollection:[]});this.setModel(this._oNotesModel,"noteModel");this.oCreateModel=new J();this.setModel(this.oCreateModel,"create");this.initLocalModel();this.oODataModel=i.getModel();this.oErrorHandler=i.getErrorHandler();this._oAttachmentsContainer=this.byId("attachmentsContainer");if(!a.system.phone){this.byId("leaveTypeSelectionForm").addDependent(this.byId("absDescLink"));}this.oCreateModel.attachPropertyChange(this._revalidateSaveButtonStatus,this);this.oODataModel.attachPropertyChange(this._revalidateSaveButtonStatus,this);if(v.getMetadata().hasEvent("navigate")){this.getView().byId("startDate").attachNavigate(this.onCalendarNavigate,this);}if(t.getMetadata().hasEvent("navigate")){this.getView().byId("dateRange").attachNavigate(this.onCalendarNavigate,this);}this.oODataModel.getMetaModel().loaded().then(function(){var A=this._getAdditionalFieldMetaInfo("PrevDay");this._bCheckboxFieldsAreBoolean=A.type==="Edm.Boolean";var p=this._getLeaveSpanDateFieldMetaInfo("EndDate");this._bCheckLeaveSpanFIDateIsEdmTime=p.type==="Edm.DateTime";this._bApproverOnBehalfPropertyExists=this._checkForSearchApproverPropertyExistence();this._bQuotaAvailabilityFIHasDateParams=this._quotaAvailabilityFIHasDateParams();}.bind(this));},initLocalModel:function(){this.setModelProperties(this.oCreateModel,{"uploadPercentage":0,"multiOrSingleDayRadioGroupIndex":0,"isQuotaCalculated":undefined,"BalanceAvailableQuantityText":undefined,"TimeUnitName":undefined,"attachments":[],"isAttachmentMandatory":false,"isAttachmentUploadEnabled":true,"notes":"","showDatePicker":false,"showRange":true,"usedWorkingTime":undefined,"usedWorkingTimeUnit":undefined,"aProposedApprovers":[],"AdditionalFields":[],"showTimePicker":false,"showInputHours":false,"timePickerFilled":false,"inputHoursFilled":false,"viewTitle":null,"busy":false,"sEditMode":null,"sAttachmentsTitle":this.getResourceBundle().getText("attachmentToolbarTitle",[0]),"iMaxApproverLevel":0,"iCurrentApproverLevel":0,"IsMultiLevelApproval":false,"isApproverEditable":false,"isApproverVisible":false,"isLoadingApprovers":false,"isAddDeleteApproverAllowed":false,"isNoteVisible":false,"AbsenceDescription":"","AbsenceTypeName":"","bUseDateDefaults":true,"oLeaveStartDate":null,"oLeaveEndDate":null,"sDateRangeValueState":sap.ui.core.ValueState.None,"isSaveRequestPending":false,"saveButtonEnabled":false,"calendar":{overlapNumber:0,assignmentId:this.sCEEmployeeId,opened:false}},undefined,false);},onAbsenceTypeReceived:function(i){var p=i.getParameter("data");if(!p||(p&&!p.results)){this.sCEEmployeeId=null;return;}this._absenceTypeReceivedDeferred.resolve(p.results);},onNumberChange:function(i){var p=i.getSource(),N=p.getValue();if(N===""){p.setValue("0");}},onExit:function(){this.oErrorHandler.clearErrors();this.oCreateModel.detachPropertyChange(this._revalidateSaveButtonStatus,this);this.oODataModel.detachPropertyChange(this._revalidateSaveButtonStatus,this);if(this._oDialog){this._oDialog.destroy();}if(this._oSearchHelperDialog){this._oSearchHelperDialog.destroy();}if(this._oOverlapCalendar){this._oOverlapCalendar.destroy();}if(this._overlapDialog){this._overlapDialog.destroy();}this._destroyAdditionalFields();this._cleanupUnsubmittedViewChanges();},onSendRequest:function(){var p={},A=this.getView().getBindingContext().getPath();this._copyAdditionalFieldsIntoModel(this.oCreateModel.getProperty("/AdditionalFields"),this.oODataModel,A);if(!this._requiredAdditionalFieldsAreFilled()){this.byId("createMessagesIndicator").focus();return;}if(this._checkFormFieldsForError()){this.byId("createMessagesIndicator").focus();return;}var G=function(i,V){var R=this.oODataModel.getProperty(i);if(V===R){return;}if(V&&V.equals&&V.equals(R)){return;}p[i]=R;this.oODataModel.setProperty(i,V);}.bind(this);if(this.oCreateModel.getProperty("/notes")){G(A+"/Notes",this.oCreateModel.getProperty("/notes"));}else{G(A+"/Notes",this._notesBuffer);}var K=[];if(this.oUploadCollection){K=this.oUploadCollection.getItems();if(K.length>x){this.oErrorHandler.pushError(this.getResourceBundle().getText("txtMaxAttachmentsReached"));this.oErrorHandler.displayErrorPopup();this.oErrorHandler.setShowErrors("immediately");return;}}else if(this.oUploadSet){K=this.oUploadSet.getItems().concat(this.oUploadSet.getIncompleteItems());}if(this.oCreateModel.getProperty("/isAttachmentMandatory")&&K.length===0){this.oErrorHandler.pushError(this.getResourceBundle().getText("txtAttachmentsRequired"));this.oErrorHandler.displayErrorPopup();this.oErrorHandler.setShowErrors("immediately");return;}this._updateLeaveRequestWithModifiedAttachments(this.oODataModel,A);if((this.oCreateModel.getProperty("/multiOrSingleDayRadioGroupIndex")===null)||(this.oCreateModel.getProperty("/multiOrSingleDayRadioGroupIndex")===0)){this.oODataModel.setProperty(A+"/PlannedWorkingHours","0.0");this.oODataModel.setProperty(A+"/StartTime","");this.oODataModel.setProperty(A+"/EndTime","");}if(this.oCreateModel.getProperty("/sEditMode")==="DELETE"){this.oODataModel.setProperty(A+"/ActionID",3);}var N=function(R){this.oCreateModel.setProperty("/busy",false);this.oCreateModel.setProperty("/uploadPercentage",0);Object.keys(p).forEach(function(Y){var Z=p[Y];this.oODataModel.setProperty(Y,Z);}.bind(this));var V=this.oODataModel.getProperty(A),W="",X="";for(var i=0;i<x;i++){X="Attachment"+(i+1);W=A+"/"+X;if(V[X]&&!this.oODataModel.getProperty(W+"/AttachmentStatus")){this.oODataModel.setProperty(W,{FileName:"",FileType:"",FileSize:"0"});}}};if(this.oODataModel.hasPendingChanges()){var Q={requestID:this.oODataModel.getProperty(A+"/RequestID"),aUploadedFiles:[],leavePath:A,showSuccess:true};this.oODataModel.setProperty(A+"/IsMultiLevelApproval",this.oCreateModel.getProperty("/IsMultiLevelApproval"));this.oCreateModel.setProperty("/busy",true);this.submitLeaveRequest(Q).then(this._uploadAttachments.bind(this)).then(this._showSuccessStatusMessage.bind(this)).catch(N.bind(this));}else if(this.oODataModel.getProperty(A+"/StatusID")==="REJECTED"){this.oCreateModel.setProperty("/busy",true);this.oODataModel.update(A,this.oODataModel.getObject(A),{success:function(){this._showSuccessStatusMessage();}.bind(this),error:function(){N.call(this);}.bind(this)});}else{g.show(this.getResourceBundle().getText("noChangesFound"));}},onCancel:function(){this._confirmCancel();},submitLeaveRequest:function(p){return new Promise(function(R,i){this.oCreateModel.setProperty("/isSaveRequestPending",true);this.oODataModel.submitChanges({success:function(A,G){this.oCreateModel.setProperty("/isSaveRequestPending",false);var K=G.data.__batchResponses[0],N={};if(K.response){N=K.response;}else if(K.__changeResponses){N=K.__changeResponses[0];}if(N.statusCode.substr(0,1)==="2"){if(N.headers.requestid){p.requestID=N.headers.requestid;}R(p);}else{i();}}.bind(this),error:function(A){this.oCreateModel.setProperty("/isSaveRequestPending",false);i(A);}.bind(this)});}.bind(this));},createLeaveRequestCollection:function(){return this.oODataModel.createEntry("/LeaveRequestSet",{properties:{StartDate:null,EndDate:null,StartTime:'',EndTime:''}});},onAbsenceTypeChange:function(i){var A,p=i.getParameter("selectedItem"),G=this.getView().getBindingContext().getPath();if(p){A=p.getBindingContext();this.updateOdataModel(A.getObject(),{});var K=A.getProperty("toAdditionalFieldsDefinition")||[],N=this._getAdditionalFieldValues(K,this._getCurrentAdditionalFieldValues()),Q={definition:K,values:N};this._destroyAdditionalFields();var R=A.getObject({expand:"toApprover"});this._handleApprovers(G,R.toApprover);this._updateLocalModel(Q,R,this.oODataModel.getProperty(G+"/StartDate"),this.oODataModel.getProperty(G+"/EndDate"));if(!(R.IsRecordInClockTimesAllowed&&R.IsAllowedDurationPartialDay)){this.oODataModel.setProperty(G+"/StartTime","");this.oODataModel.setProperty(G+"/EndTime","");}if(!(R.IsRecordInClockHoursAllowed&&R.IsAllowedDurationPartialDay)){this.oODataModel.setProperty(G+"/PlannedWorkingHours","0.0");}this._handleAttachments(A.getObject());this._fillAdditionalFields(this.oCreateModel,A.getProperty("AbsenceTypeCode"),this._getAdditionalFieldsContainer());this._fillAdditionalFieldTexts(K,N);this._updateCalcLeaveDays(false);}},onShowLeaveTypeDescriptionPressed:function(i){if(!this._oLeaveTypeDescriptionDialog){var V=this.getView();this._oLeaveTypeDescriptionDialog=u.setResizableDraggableForDialog(sap.ui.xmlfragment("hcm.fab.myleaverequest.view.fragments.LeaveTypeDescriptionDialog",this));jQuery.sap.syncStyleClass(this.getOwnerComponent().getContentDensityClass(),V,this._oLeaveTypeDescriptionDialog);V.addDependent(this._oLeaveTypeDescriptionDialog);}this._oLeaveTypeDescriptionDialog.openBy(i.getSource());},onSingleMultiDayRadioSelected:function(i){var p=this.getView().getBindingContext().getPath(),A=this.oODataModel.getProperty(p+"/StartDate"),G=this.oODataModel.getProperty(p+"/EndDate"),K=i.getSource().getSelectedIndex()===0,N=false;if(A){if(A.getTime()!==G.getTime()){N=true;}if((K&&!G)||(!K)){this.oODataModel.setProperty(p+"/EndDate",A);this.oCreateModel.setProperty("/oLeaveEndDate",q.convertToLocal(A));}if(N){this._updateCalcLeaveDays(false);if(!K){this._updateApprovers(this.getSelectedAbsenceTypeControl().getBindingContext().getObject(),A,G);}}}},onDateRangeChanged:function(i){var V=i.getParameter("valid"),p=i.getParameter("from"),A=u.dateToUTC(p),G=this.getView().getBindingContext().getPath("StartDate"),K=i.getParameter("to"),N=u.dateToUTC(K),Q=this.getView().getBindingContext().getPath("EndDate");if(V){this.oCreateModel.setProperty("/bUseDateDefaults",false);if(!K){this.oCreateModel.setProperty("/oLeaveEndDate",p);N=A;}this.oCreateModel.setProperty("/sDateRangeValueState",sap.ui.core.ValueState.None);this.oODataModel.setProperty(G,A);this.oODataModel.setProperty(Q,N);this._updateCalcLeaveDays(false);this._updateAvailableQuota(this.getSelectedAbsenceTypeControl().getBindingContext().getObject(),A,N);this._updateApprovers(this.getSelectedAbsenceTypeControl().getBindingContext().getObject(),A,N);this._showBusyDialog(i.getSource());this._revalidateSaveButtonStatus();}else{this.oCreateModel.setProperty("/sDateRangeValueState",sap.ui.core.ValueState.Error);}},onInputHoursChange:function(i){var V;if(this.getModel("global").getProperty("/bShowIndustryHours")){var p=parseFloat(i.getParameter("value"),10);V=isNaN(p)?0:p;}else{V=this._convertHoursMinutesFromDateToDecimal(i.getSource().getDateValue());}if(V<=24){var A=this.getView().getBindingContext(),G=A.getPath("StartTime"),K=A.getPath("EndTime"),N=A.getPath("PlannedWorkingHours");this.oODataModel.setProperty(G,"");this.oODataModel.setProperty(K,"");if(!this.getModel("global").getProperty("/bShowIndustryHours")){this.oODataModel.setProperty(N,V);}this._updateCalcLeaveDays(true);this._showBusyDialog(i.getSource());}this.oCreateModel.setProperty("/inputHoursFilled",V!==0&&V<=24);this._revalidateSaveButtonStatus();},onDatePickChanged:function(i){var V=i.getParameter("valid");if(V){var p=n.getDateInstance({UTC:true}).parse(i.getParameter("newValue"),true),A=this.getView().getBindingContext().getPath("EndDate");this.oCreateModel.setProperty("/bUseDateDefaults",false);this.oCreateModel.setProperty("/oLeaveStartDate",q.convertToLocal(p));this.oCreateModel.setProperty("/oLeaveEndDate",q.convertToLocal(p));this.oODataModel.setProperty(A,p);this._updateCalcLeaveDays(false);this._updateAvailableQuota(this.getSelectedAbsenceTypeControl().getBindingContext().getObject(),p,p);this._showBusyDialog(i.getSource());}this._revalidateSaveButtonStatus();},onTimeChange:function(i){this.oCreateModel.setProperty("/timePickerFilled",(i.getParameter("newValue"))?true:false);this._updateCalcLeaveDays(false);this._showBusyDialog(i.getSource());},onApproverValueHelp:function(i){if(!this._oDialog){this._oDialog=u.setResizableDraggableForDialog(sap.ui.xmlfragment("hcm.fab.myleaverequest.view.fragments.ApproverDialog",this));jQuery.sap.syncStyleClass(this.getOwnerComponent().getContentDensityClass(),this.getView(),this._oDialog);this.getView().addDependent(this._oDialog);this._oSearchApproverItemTemplate=new S({info:"{Information}",description:"{Description}",icon:{parts:["global>/showEmployeePicture","toEmployeePicture/__metadata/media_src"],formatter:f.formatImageURL},iconDensityAware:false,iconInset:false,title:{parts:["global>/showEmployeeNumber","global>/bShowEmployeeNumberWithoutZeros","ApproverEmployeeName","ApproverEmployeeID"],formatter:f.formatObjectTitle},adaptTitleSize:false,customData:[{key:"ApproverEmployeeID",value:"{ApproverEmployeeID}"}]});if(this._oSearchApproverItemTemplate.setWrapping){this._oSearchApproverItemTemplate.setWrapping(true);}}this._oDialog.data("initiator",i.getSource());this._oDialog.data("approverLevel",i.getSource().data("approverLevel"));this._oDialog.bindAggregation("items",{path:"/SearchApproverSet",filters:this._getApproverSearchFilters(),parameters:{custom:{}},template:this._oSearchApproverItemTemplate});this._oDialog.open();},onRemoveApproverClicked:function(i){var p=this.oCreateModel.getProperty("/iCurrentApproverLevel"),A=this.getView().getBindingContext().getPath(),G=A+"/ApproverLvl"+p;this.oODataModel.setProperty(G+"/Name","");this.oODataModel.setProperty(G+"/Pernr","000000");this.oODataModel.setProperty(G+"/Seqnr","000");this.oODataModel.setProperty(G+"/DefaultFlag",false);this.oCreateModel.setProperty("/iCurrentApproverLevel",p-1);},onAddApproverClicked:function(i){var p=this.oCreateModel.getProperty("/iCurrentApproverLevel"),A=this.oCreateModel.getProperty("/aProposedApprovers"),G=A[p];if(G){var K=this.getView().getBindingContext().getPath(),N=K+"/ApproverLvl"+(p+1);this.oODataModel.setProperty(N+"/Name",G.Name);this.oODataModel.setProperty(N+"/Pernr",G.Pernr);this.oODataModel.setProperty(N+"/Seqnr",G.Seqnr);this.oODataModel.setProperty(N+"/DefaultFlag",G.DefaultFlag);}this.oCreateModel.setProperty("/iCurrentApproverLevel",p+1);},onNotesLiveChange:function(i){var p=i.getParameter("newValue");if(p.length<2){return;}if(p.indexOf("::")>-1){var A=i.getSource().getFocusDomRef().selectionStart;i.getSource().setValue(p.replace(/(:)+/g,"$1"));i.getSource().getFocusDomRef().setSelectionRange(A,A-1);}},onAdditionalFieldLiveChange:function(i){if(!i.getParameter("newValue")){this.oCreateModel.setProperty(i.getSource().getBinding("value").getContext().getPath()+"/descriptionText","");}this._checkRequiredField(i.getSource());},onFileSizeExceeded:function(i){var p={},A="",G=0,K=0;if(i.getSource().getMetadata().getName()==="sap.m.UploadCollection"){p=i.getParameter("files")[0];A=p.name;G=p.fileSize*1024;K=i.getSource().getMaximumFileSize();}else{var N=i.getParameter("item");p=N.getFileObject();if(!p){return;}A=p.name;G=p.size/1024;K=i.getSource().getMaxFileSize();i.getSource().removeIncompleteItem(N);}h.warning(this.getResourceBundle().getText("attachmentFileSizeTooBig",[A,f.formatFileSize(G),K]));},onFileTypeMissmatch:function(i){var p="",A="",G=[];if(i.getSource().getMetadata().getName()==="sap.m.UploadCollection"){p=i.getParameter("files")[0].fileType;G=i.getSource().getFileType();A=G.join(", ");}else{var K=i.getParameter("item");G=i.getSource().getFileTypes();p=this._getFileTypeFromFileName(K.getFileName());A=G.join(", ");i.getSource().removeIncompleteItem(K);}h.warning(this.getResourceBundle().getText(G.length>1?"attachmentWrongFileTypeMult":"attachmentWrongFileType",[p,A]));},onBeforeUploadStartsSet:function(i){var p=i.getSource(),A=jQuery.sap.encodeURL(i.getParameter("item").getFileName());p.destroyHeaderFields();p.addHeaderField(new sap.ui.core.Item({key:"slug",text:A}));p.addHeaderField(new sap.ui.core.Item({key:"x-csrf-token",text:this.oODataModel.getSecurityToken()}));p.addHeaderField(new sap.ui.core.Item({key:"Content-Disposition",text:"attachment;filename="+A}));},onBeforeAttachmentItemAdded:function(i){var p=i.getParameter("item"),N=p.getFileObject(),A=false,G=i.getSource().getItems(),K=i.getSource().getIncompleteItems(),Q=function(R){if(!A&&R.getProperty("fileName")===N.name){h.warning(this.getResourceBundle().getText("duplicateAttachment"));A=true;return;}}.bind(this);this._oItemToRemove=p;G.forEach(Q);if(A){return;}K.forEach(Q);if(A){return;}this._oItemToRemove=null;},onAfterAttachmentItemAdded:function(i){if(this._oItemToRemove){this.oUploadSet.removeIncompleteItem(this._oItemToRemove);this._oItemToRemove=null;}var A=i.getSource().getItems().concat(i.getSource().getIncompleteItems());if(A.length===x){g.show(this.getResourceBundle().getText("maxAttachment"));}},onAttachmentChange:function(i){var p=false,A=this.oUploadCollection.getItems(),G=A[0],N=i.getParameter("files")[0];this._oNewFileData[N.name]=N;A.forEach(function(Q){if(Q.getProperty("fileName")===N.name){h.warning(this.getResourceBundle().getText("duplicateAttachment"),{onClose:function(){this.oUploadCollection.removeItem(Q);}.bind(this)});p=true;return;}}.bind(this));if(!p){if(A.length===x-1){g.show(this.getResourceBundle().getText("maxAttachment"));}else{var K=this.oUploadCollection._aFileUploadersForPendingUpload;if(K.length>=1&&G&&G._status!=="display"){h.warning(this.getResourceBundle().getText("oneAttachmentAllowed"),{onClose:function(){this.oUploadCollection.removeItem(G);}.bind(this)});}}}},onBeforeUploadStarts:function(i){var p=i.getParameters(),A=jQuery.sap.encodeURL(i.getParameter("fileName"));p.addHeaderParameter(new m({name:"slug",value:A}));p.addHeaderParameter(new m({name:"x-csrf-token",value:this.oODataModel.getSecurityToken()}));p.addHeaderParameter(new m({name:"Content-Disposition",value:"attachment;filename="+A}));},onHandlePopover:function(i){var p=i.getSource(),V=this.getView();if(!this._oMessagePopover){this._oMessagePopover=new M({items:{path:"message>/",template:new e({description:"{message>description}",type:"{message>type}",title:"{message>message}",subtitle:"{message>additionalText}"})}});jQuery.sap.syncStyleClass(this.getOwnerComponent().getContentDensityClass(),V,this._oMessagePopover);V.addDependent(this._oMessagePopover);}this._oMessagePopover.toggle(p);},handleApproverDialogSearch:function(i){var p=i.getParameter("value");i.getSource().removeAllItems();i.getSource().bindAggregation("items",{path:"/SearchApproverSet",filters:this._getApproverSearchFilters(),parameters:{custom:p?{search:encodeURIComponent(p)}:{}},template:this._oSearchApproverItemTemplate});},handleApproverDialogClose:function(i){var p=i.getParameter("selectedItem");if(p){var A=i.getSource().data("initiator"),G=i.getSource().data("approverLevel"),K=this.getView().getBindingContext().getPath()+"/ApproverLvl"+G;A.setValue(p.getTitle());this.oODataModel.setProperty(K+"/Pernr",p.data("ApproverEmployeeID"));}i.getSource().removeAllItems();},handleApproverDialogCancel:function(i){i.getSource().removeAllItems();},handleSearchHelperDialogSearch:function(i){var p,A,G;G=i.getSource().data("initiator");A=i.getParameter("value");var K=new F({filters:G.data("helperCollectionFilterFields").split(",").map(function(N){return new F(N,b.Contains,A);}),and:false});p=i.getSource().getBinding("items");p.filter([K]);},handleSearchHelperDialogClose:function(i){var p,A,G=i.getParameter("selectedItem");if(!G){return;}A=i.getSource().data("initiator");p=G.getProperty("title")==="(space)"?"":G.getProperty("title");var K=A.getBindingContext("create").getPath();this.oCreateModel.setProperty(K+"/fieldValue",p);var N=G.getProperty("description");this.oCreateModel.setProperty(K+"/descriptionText",N);this._checkRequiredField(A);this._revalidateSaveButtonStatus();},onSearchHelperRequest:function(i){var p=i.getSource();var A=p.getValue();if(!this._oSearchHelperDialog){var G={handleSearch:this.handleSearchHelperDialogSearch.bind(this),handleClose:this.handleSearchHelperDialogClose.bind(this)};this._oSearchHelperDialog=u.setResizableDraggableForDialog(sap.ui.xmlfragment("hcm.fab.myleaverequest.view.fragments.SearchHelperDialog",G));}this.getSearchHelperDialogModel(p.data("helperTitleText"),p.data("helperNoDataFoundText"),p.data("helperCollection"),p.data("helperCollectionTitleField"),p.data("helperCollectionDescriptionField")).then(function(K){this._oSearchHelperDialog.setModel(K);this._oSearchHelperDialog.data("initiator",p);this.handleSearchHelperDialogSearch(new E("initSearch",this._oSearchHelperDialog,{value:A}));this._oSearchHelperDialog.open(A);}.bind(this));},onNavBack:function(){this._confirmCancel();},getSelectedAbsenceTypeControl:function(){return this.getView().byId("absenceType").getSelectedItem();},getSearchHelperDialogModel:function(i,p,A,G,K){return new Promise(function(R,N){var Q=this.getModel("global").getProperty("/sCountryGrouping");this.oODataModel.read("/"+A,{filters:(A==="SearchWageTypeSet"&&Q)?[new F("CountryGrouping",b.EQ,Q)]:[],success:function(V){if(!V.hasOwnProperty("results")){N("Cannot find 'results' member in the "+A+" collection");return;}var W={DialogTitle:i,NoDataText:p,Collection:[]};W.Collection=V.results.map(function(X){var Y=jQuery.extend({},X,true);Y.Title=X[G]===""?"(space)":X[G];Y.Description=X[K];return Y;});R(new J(W));},error:function(V){N(V);}});}.bind(this));},setModelProperties:function(i,p,A,G){var K=Object.keys(p);var N=K.length;K.forEach(function(Q,R){var V=true;var W=(A||"")+"/"+Q;if(R===N-1&&G){V=false;}i.setProperty(W,p[Q],V);});},updateOdataModel:function(A,R){var N={"EmployeeID":A.EmployeeID,"AbsenceTypeName":A.AbsenceTypeName,"AbsenceTypeCode":R.absenceType&&R.absenceType!=="default"?R.absenceType:A.AbsenceTypeCode},i=R.dateFrom?new Date(parseInt(R.dateFrom,10)):null,p=R.dateTo?new Date(parseInt(R.dateTo,10)):null,G=this.getView().getBindingContext().getPath();if(this.oCreateModel.getProperty("/bUseDateDefaults")){i=i||A.DefaultStartDate;p=p||A.DefaultEndDate;}if(!A.IsAllowedDurationMultipleDay){p=this.oCreateModel.getProperty("/oLeaveStartDate")||i;}if(i){N.StartDate=i;}if(p){N.EndDate=p;}this.setModelProperties(this.oODataModel,N,G,false);},onOverlapOpen:function(){if(!this._overlapDialog){this.getView().removeDependent(this._oOverlapCalendar);this._overlapDialog=new r({title:"{i18n>overlapCalendarLabel}",contentWidth:"80rem",contentHeight:"44rem",draggable:true,resizable:true,stretch:a.system.phone,content:[this._oOverlapCalendar],beginButton:[new s({text:"{i18n>calendarOverlapCloseButtonText}",tooltip:"{i18n>calendarOverlapCloseButtonText}",press:function(){this._overlapDialog.close();this.oCreateModel.setProperty("/calendar/opened",false);}.bind(this)})]});this.getView().addDependent(this._overlapDialog);}this.oCreateModel.setProperty("/calendar/opened",true);this._overlapDialog.open();},onCalendarNavigate:function(i){var p=i.getSource(),A=i.getParameter("dateRange").getStartDate(),G=i.getParameter("dateRange").getEndDate();if(A.getDate()>20){A.setDate(1);A.setMonth(A.getMonth()+1);}if(G.getDate()<10){G.setDate(0);}C.configureCalendar(i.getSource()._oCalendar,this.getModel(),this.getResourceBundle());p.setBusy(true);p.removeAllSpecialDates();this._oDataUtil.getCalendarEvents(A,G).then(function(R){p.setBusy(false);C.fillCalendarWithLeaves(p,R.leaveRequests,A,G);C.fillCalendarFromEmployeeCalendar(p,R.workSchedule);});},_navBack:function(){this.oErrorHandler.setShowErrors("immediately");this.oErrorHandler.clearErrors();this.getView().unbindElement();this.getView().setBindingContext(null);this.initLocalModel();this._doAttachmentCleanup();var p=H.getInstance().getPreviousHash(),i=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");if(p!==undefined||(i&&!i.isInitialNavigation())){if(i){i.historyBack();}else{window.history.go(-1);}}else{i.toExternal({target:{shellHash:i.hrefForExternal({target:{shellHash:"#"}})}});}},_confirmCancel:function(){var i=this.getOwnerComponent();if(this._hasPendingChanges()){h.confirm(this.getResourceBundle().getText("cancelPopover"),{styleClass:i.getContentDensityClass(),initialFocus:h.Action.CANCEL,onClose:function(A){if(A===h.Action.OK){this._cleanupUnsubmittedViewChanges();this._navBack();}}.bind(this)});}else{this._navBack();}},_updateChangeRelevantLocalModelProperty:function(p,i){y.forEach(function(A){if(A===p){this._oLocalModelProperties[A]=JSON.stringify(i);}}.bind(this));},_rememberChangeRelevantLocalModelProperties:function(){this._oLocalModelProperties={};y.forEach(function(A){var p=this.oCreateModel.getProperty("/"+A);this._oLocalModelProperties[A]=JSON.stringify(p);}.bind(this));var i=this._getAttachmentItemList();this._oLocalModelProperties.AttachmentList=JSON.stringify(i);},_hasPendingChanges:function(){if(this.oODataModel.hasPendingChanges())return true;if(!this._oLocalModelProperties)return false;for(var i=0;i<y.length;i++){var p=y[i];var A=JSON.stringify(this.oCreateModel.getProperty("/"+p));if(this._oLocalModelProperties[p]!==A)return true;}var G=this._getAttachmentItemList();if(this._oLocalModelProperties.AttachmentList!==JSON.stringify(G))return true;return false;},_revalidateSaveButtonStatus:function(){var i=this.getView().getBindingContext().getObject();if(!i||!i.AbsenceTypeCode||!i.StartDate){this.oCreateModel.setProperty("/saveButtonEnabled",false);return;}if(i.StatusID==="REJECTED"||this.oCreateModel.getProperty("/sEditMode")==="DELETE"){this.oCreateModel.setProperty("/saveButtonEnabled",true);return;}this.oCreateModel.setProperty("/saveButtonEnabled",this._hasPendingChanges());},_onCreateRouteMatched:function(i){var R=i.getParameter("arguments"),A=this.getOwnerComponent().getAssignmentPromise();this.oErrorHandler.setShowErrors("immediately");this.oErrorHandler.clearErrors();this.oCreateModel.setProperty("/sEditMode","CREATE");this.oCreateModel.setProperty("/bUseDateDefaults",!R.dateFrom&&!R.dateTo);this._notesBuffer="";this._destroyAdditionalFields();this._cleanupUnsubmittedViewChanges();this.oCreateModel.setProperty("/viewTitle",this.getResourceBundle().getText("createViewTitle"));Promise.all([this.oODataModel.metadataLoaded(),A,this.oODataModel.getMetaModel().loaded()]).then(function(p){this._absenceTypeReceivedDeferred=u.createDeferred();this.sCEEmployeeId=p[1];this._oSelectionItemTemplate=this.getView().byId("selectionTypeItem");this.oCreateModel.setProperty("/busy",true);this.getView().byId("absenceType").bindItems({path:"/AbsenceTypeSet",template:this._oSelectionItemTemplate,filters:[new F("EmployeeID",b.EQ,this.sCEEmployeeId)],parameters:{expand:"toAdditionalFieldsDefinition,toApprover"},events:{dataReceived:this.onAbsenceTypeReceived.bind(this)}});this._oDataUtil=D.getInstance(this.sCEEmployeeId,this.getModel());this._initOverlapCalendar();this._absenceTypeReceivedDeferred.promise.then(function(G){var V=this.createLeaveRequestCollection(),K=V.getPath(),N=G.filter(function(_){if(R.absenceType&&R.absenceType!=="default"){return _.AbsenceTypeCode===R.absenceType;}else{return _.DefaultType;}}),Q=N.length!==0?N[0]:G[0].AbsenceTypeCode;this.getView().setBindingContext(V);this.updateOdataModel(Q,R);var W=jQuery.extend(true,{},Q),X=this.getSelectedAbsenceTypeControl().getBindingContext(),Y=X.getProperty("toAdditionalFieldsDefinition")||[],Z=this._getAdditionalFieldValues(Y,{}),$={definition:Y,values:Z};this._handleApprovers(K,Q.toApprover.results);this._updateLocalModel($,W,this.oODataModel.getProperty(K+"/StartDate"),this.oODataModel.getProperty(K+"/EndDate"));this._handleAttachments(W);this._fillAdditionalFields(this.oCreateModel,W.AbsenceTypeCode,this._getAdditionalFieldsContainer());this._fillAdditionalFieldTexts(Y,Z);this._updateCalcLeaveDays(false);this.oCreateModel.setProperty("/busy",false);this._rememberChangeRelevantLocalModelProperties();this._revalidateSaveButtonStatus();}.bind(this));}.bind(this));},_onDeletePostedLeaveRouteMatched:function(i){this.oCreateModel.setProperty("/sEditMode","DELETE");this._onEditRouteMatchedInternal(i);},_onEditRouteMatched:function(i){this.oCreateModel.setProperty("/sEditMode","EDIT");this._onEditRouteMatchedInternal(i);},_onEditRouteMatchedInternal:function(i){var R=i.getParameter("arguments"),p="/"+R.leavePath,A=this.getOwnerComponent().getAssignmentPromise(),V=this.getView();this.oErrorHandler.setShowErrors("immediately");this.oErrorHandler.clearErrors();this._destroyAdditionalFields();this.oCreateModel.setProperty("/bUseDateDefaults",false);this.oCreateModel.setProperty("/viewTitle",this.getResourceBundle().getText(this.oCreateModel.getProperty("/sEditMode")==="DELETE"?"deleteLeaveRequest":"editViewTitle"));this._cleanupUnsubmittedViewChanges();this.oCreateModel.setProperty("/busy",true);Promise.all([this.oODataModel.metadataLoaded(),A,this.oODataModel.getMetaModel().loaded()]).then(function(G){if(this.sCEEmployeeId!==G[1]){this._absenceTypeReceivedDeferred=u.createDeferred();this.sCEEmployeeId=G[1];this._oSelectionItemTemplate=V.byId("selectionTypeItem");V.byId("absenceType").bindItems({path:"/AbsenceTypeSet",template:this._oSelectionItemTemplate,filters:[new F("EmployeeID",b.EQ,this.sCEEmployeeId)],parameters:{expand:"toAdditionalFieldsDefinition,toApprover"},events:{dataReceived:this.onAbsenceTypeReceived.bind(this)}});}this._oDataUtil=D.getInstance(this.sCEEmployeeId,this.getModel());this._initOverlapCalendar();this._absenceTypeReceivedDeferred.promise.then(function(K){var N=V.getModel().getProperty(p),Q=function(W){var X=this.getSelectedAbsenceTypeControl();this._notesBuffer=W.Notes;var Y=this.formatter.formatNotes(this._notesBuffer);this._oNotesModel.setProperty("/NoteCollection",Y);var Z=X.getBindingContext(),$=Z.getObject(),_=Z.getProperty("toAdditionalFieldsDefinition"),a1=this._getAdditionalFieldValues(_,W.AdditionalFields),b1={definition:_,values:a1};var c1=Array.apply(null,{length:w}).map(function(d1,e1){return W["ApproverLvl"+(e1+1)];}).filter(function(d1){return d1&&d1.Pernr!=="00000000";});this.oCreateModel.setProperty("/iCurrentApproverLevel",c1.length);this.oCreateModel.setProperty("/aProposedApprovers",c1);this._updateLocalModel(b1,Z.getObject(),W.StartDate,W.EndDate);this._handleAttachments(Z.getObject(),W);this._fillAdditionalFields(this.oCreateModel,$.AbsenceTypeCode,this._getAdditionalFieldsContainer());this._fillAdditionalFieldTexts(_,a1);this._updateCalcLeaveDays(false);this.oCreateModel.setProperty("/busy",false);this.oErrorHandler.setShowErrors("immediately");this._rememberChangeRelevantLocalModelProperties();this._revalidateSaveButtonStatus();}.bind(this);if(!N||N.hasOwnProperty("ReqOrInfty")){this.oErrorHandler.setShowErrors("manual");V.bindElement({path:p,events:{change:function(i){if(!V.getElementBinding().getBoundContext()){setTimeout(function(){this.oErrorHandler.displayErrorPopup(function(){u.navTo.call(this,"overview",true);this.oCreateModel.setProperty("/busy",false);this.oErrorHandler.setShowErrors("immediately");}.bind(this));}.bind(this),0);return;}var W=V.getBindingContext().getObject();if(W){Q(W);}}.bind(this)}});}else{V.setBindingContext(new sap.ui.model.Context(V.getModel(),p));Q(N);}}.bind(this));}.bind(this));},_destroyAdditionalFields:function(){Object.keys(this._oAdditionalFieldsControls).forEach(function(i){var p=this._oAdditionalFieldsControls[i];p.forEach(function(A,G){A.destroy();if(G>0){delete this._oAdditionalFieldsControls[i];}}.bind(this));}.bind(this));},_getAdditionalFieldsContainer:function(){return this.getView().byId("additionalFieldsSimpleForm");},_getAdditionalFieldFragmentName:function(A,i){var p="";switch(A.Type_Kind){case"C":p="AdditionalFieldInput";var G=this.oODataModel.getProperty(i+"/AdditionalFields/"+A.Fieldname);if(typeof G==="boolean"||this._isFieldShownAsCheckbox(A)){p="AdditionalFieldCheckbox";}else if(A.HasF4){p="AdditionalFieldSearchHelperInput";}break;case"P":p=null;break;case"N":p="AdditionalFieldInputInteger";break;case"D":p="AdditionalFieldDatePicker";break;case"T":p="AdditionalFieldTimePicker";break;default:p="AdditionalFieldInput";}return p;},_callCalcLeaveDaysFunctionImport:function(p){return new Promise(function(R,i){this.oODataModel.callFunction("/CalculateLeaveSpan",{method:"GET",groupId:"leaveDuration",urlParameters:p,success:function(A){R(A);},error:function(A){i(A);}});}.bind(this));},_callAvailableQuotaFunctionImport:function(p){return new Promise(function(R,i){this.oODataModel.callFunction("/CalculateQuotaAvailable",{method:"GET",groupId:"quotaAvailability",urlParameters:p,success:function(A){R(A);},error:function(A){i(A);}});}.bind(this));},_callGetMultiApproversFunctionImport:function(p){return new Promise(function(R,i){this.oCreateModel.setProperty("/isLoadingApprovers",true);this.oODataModel.callFunction("/GetMultiLevelApprovers",{method:"GET",groupId:"getMultiApprovers",urlParameters:p,success:function(A){R(A);},error:function(A){i(A);}});}.bind(this));},_cleanupUnsubmittedViewChanges:function(){var i=this.getView().getBindingContext();if(i){if(this.oCreateModel.getProperty("/sEditMode")!=="CREATE"){if(this.oODataModel.hasPendingChanges()){this.oODataModel.resetChanges([i.getPath()]);}}else if(i){this.oODataModel.deleteCreatedEntry(i);}}this.getView().unbindElement();},_updateCalcLeaveDays:function(i){var p=this.getView().getBindingContext().getPath(),A=this.oCreateModel.getProperty("/sEditMode"),R=this.oODataModel.getProperty(p+"/StartDate"),G=this.oODataModel.getProperty(p+"/EndDate"),K=this.oODataModel.getProperty(p+"/AbsenceTypeCode"),N=n.getDateTimeInstance({pattern:"yyyyMMdd",UTC:true});if(!R||!f.isGroupEnabled(R,K)){return;}var Q=null;var V=null;if(this._bCheckLeaveSpanFIDateIsEdmTime){Q=R;V=G;}else{Q=N.format(R);V=N.format(G);}this.oCreateModel.setProperty("/usedWorkingTime",this.getResourceBundle().getText("durationCalculation"));var W=null,X=null;if(this.oCreateModel.getProperty("/multiOrSingleDayRadioGroupIndex")===0){W="";X="";}else{W=this.oODataModel.getProperty(p+"/StartTime");if(!W){W="";}X=this.oODataModel.getProperty(p+"/EndTime");if(!X){X="";}}var Y=this.oODataModel.getProperty(p+"/PlannedWorkingHours");if(this.oCreateModel.getProperty("/multiOrSingleDayRadioGroupIndex")===0||!Y||Y<=0||Y>24||!i){Y="0.0";}var Z=this.oODataModel.getProperty(p+"/StatusID");if(!Z){Z="";}this._callCalcLeaveDaysFunctionImport({AbsenceTypeCode:K,EmployeeID:this.oODataModel.getProperty(p+"/EmployeeID"),InfoType:this.getSelectedAbsenceTypeControl().getBindingContext().getObject().InfoType,StartDate:Q,EndDate:V,BeginTime:W,EndTime:X,RequestID:A!=="CREATE"?this.oODataModel.getProperty(p+"/RequestID"):"",InputHours:Y,StatusID:Z,LeaveKey:A!=="CREATE"?this.oODataModel.getProperty(p+"/LeaveKey"):""}).then(function($){if(!$){this.oCreateModel.setProperty("/usedWorkingTime",null);this._closeBusyDialog();return;}if(this.oCreateModel.getProperty("/isSaveRequestPending")){return;}var _=this.oCreateModel.getProperty("/AdditionalFields"),a1=false;_.forEach(function(c1){switch(c1.Fieldname){case"AttAbsDays":c1.fieldValue=$.CalculateLeaveSpan.AttAbsDays?$.CalculateLeaveSpan.AttAbsDays:c1.fieldValue;a1=true;break;case"CaleDays":c1.fieldValue=$.CalculateLeaveSpan.CalendarDays?$.CalculateLeaveSpan.CalendarDays:c1.fieldValue;a1=true;break;case"PayrDays":c1.fieldValue=$.CalculateLeaveSpan.QuotaUsed?$.CalculateLeaveSpan.QuotaUsed:c1.fieldValue;a1=true;break;case"PayrHrs":c1.fieldValue=$.CalculateLeaveSpan.PayrollHours?$.CalculateLeaveSpan.PayrollHours:c1.fieldValue;a1=true;break;default:break;}});if(a1){this._updateChangeRelevantLocalModelProperty("AdditionalFields",_);this.oCreateModel.setProperty("/AdditionalFields",_);}this.oCreateModel.setProperty("/usedWorkingTime",parseFloat($.CalculateLeaveSpan.QuotaUsed));this.oCreateModel.setProperty("/usedWorkingTimeUnit",$.CalculateLeaveSpan.TimeUnitText);if(this.oCreateModel.getProperty("/multiOrSingleDayRadioGroupIndex")===1){var b1=0;if(this.oCreateModel.getProperty("/showInputHours")){if(this.getModel("global").getProperty("/bShowIndustryHours")){b1=this._getDecimalHoursFromInputControl();}else{b1=this._getDecimalHoursFromTimepicker();}}if(i&&b1!==0){if(this.byId("startTimePick").getVisible()){if($.CalculateLeaveSpan.BeginTime){this.oODataModel.setProperty(p+"/StartTime",$.CalculateLeaveSpan.BeginTime);}else{this.oODataModel.setProperty(p+"/StartTime","");}}if(this.byId("endTimePick").getVisible()){if($.CalculateLeaveSpan.EndTime){this.oODataModel.setProperty(p+"/EndTime",$.CalculateLeaveSpan.EndTime);}else{this.oODataModel.setProperty(p+"/EndTime","");}}}if(this.oCreateModel.getProperty("/showInputHours")&&$.CalculateLeaveSpan.AttabsHours&&$.CalculateLeaveSpan.AttabsHours!=="0.00"&&this.oODataModel.getProperty(p+"/PlannedWorkingHours")!==$.CalculateLeaveSpan.AttabsHours){this.oODataModel.setProperty(p+"/PlannedWorkingHours",$.CalculateLeaveSpan.AttabsHours);}}this._closeBusyDialog();}.bind(this),function($){this.oCreateModel.setProperty("/usedWorkingTime",null);this.oCreateModel.setProperty("/usedWorkingTimeUnit",null);this._closeBusyDialog();}.bind(this));},_updateAvailableQuota:function(A,i,p){var G={AbsenceTypeCode:A.AbsenceTypeCode,EmployeeID:A.EmployeeID,InfoType:A.InfoType};this.oCreateModel.setProperty("/BalanceAvailableQuantityText",this.getResourceBundle().getText("availabilityCalculation"));this._showBusyDialog();if(this._bQuotaAvailabilityFIHasDateParams&&i&&p){G.StartDate=i;G.EndDate=p;}return this._callAvailableQuotaFunctionImport(G).then(function(K){if(!K){this.oCreateModel.setProperty("/BalanceAvailableQuantityText",null);}else{this.oCreateModel.setProperty("/BalanceAvailableQuantityText",parseFloat(K.CalculateQuotaAvailable.BalanceRestPostedRequested));this.oCreateModel.setProperty("/TimeUnitName",K.CalculateQuotaAvailable.TimeUnitText);}this._closeBusyDialog();}.bind(this),function(K){this.oCreateModel.setProperty("/BalanceAvailableQuantityText",null);this._closeBusyDialog();}.bind(this));},_updateApprovers:function(A,i,p){if(this.getModel("global").getProperty("/bReloadApproversUponDateChange")&&A.IsMultiLevelApproval){var G={AbsenceTypeCode:A.AbsenceTypeCode,EmployeeID:A.EmployeeID,Infotype:A.InfoType,StartDate:i,EndDate:p};this._callGetMultiApproversFunctionImport(G).then(function(K){this._handleApprovers(this.getView().getBindingContext().getPath(),K.results);this.oCreateModel.setProperty("/isLoadingApprovers",false);if(K.results.length>0){this.oCreateModel.setProperty("/isAddDeleteApproverAllowed",K.results[0].IsAddDele);}}.bind(this),function(K){this.oCreateModel.setProperty("/isLoadingApprovers",false);}.bind(this));}},_getAttachmentsUploadUrl:function(p){return[this.oODataModel.sServiceUrl,p,"/toAttachments"].join("");},_updateUploadUrlsUploadCollection:function(i,p){var A="",G={};i.forEach(function(K){A=K.getFileUploader();if(A){G=sap.ui.getCore().byId(A);G.setUploadUrl(p);}}.bind(this));if(this.oUploadCollection.hasOwnProperty("_oFileUploader")){this.oUploadCollection._oFileUploader.setUploadUrl(p);}},_getAttachmentsFromModel:function(i){return Array.apply(null,{length:x}).map(function(p,A){return i["Attachment"+(A+1)];}).filter(function(A){return A.FileName!=="";});},_getAttachmentItemList:function(){var i=[];if(this.oUploadCollection){i=this.oUploadCollection.getItems().map(function(A){return{id:A.getId(),fileName:A.getFileName(),mimeType:A.getMimeType(),uploadedDate:A.getUploadedDate(),url:A.getUrl()};});}else if(this.oUploadSet){i=this.oUploadSet.getItems().concat(this.oUploadSet.getIncompleteItems());i=i.map(function(A){return{id:A.getId(),fileName:A.getFileName(),url:A.getUrl()};});}return i;},_handleAttachments:function(A,i){if(A.AttachmentEnabled){var p=[];if(i){p=this._getAttachmentsFromModel(i);}this.oCreateModel.setProperty("/attachments",p);this.oCreateModel.setProperty("/isAttachmentUploadEnabled",p.length<x);if(sap.ui.getCore().getLoadedLibraries()["sap.m"].controls.indexOf("sap.m.upload.UploadSet")!==-1){this._handleAttachmentsUploadSet(A);}else{this._handleAttachmentsUploadCollection(A);}}else{this._doAttachmentCleanup();}},_handleAttachmentsUploadSet:function(A){if(this.oUploadSet){this.oUploadSet.setMaxFileSize(this._getMaxFileSizeFromAbsenceTypeInMB(A));this.oUploadSet.setFileTypes(this._getSupportedFileTypeFromAbsenceType(A));}else{this._oAttachmentsContainer.addItem(this._createNewUploadSetInstance(A));}},_handleAttachmentsUploadCollection:function(A){if(this.oUploadCollection){if(this._isNewUploadCollectionInstanceNeeded(this.oUploadCollection,A)){if(this._informEnduserAboutLostAttachments()){h.warning(this.getResourceBundle().getText("attachmentsLost"),{onClose:function(){this._doAttachmentCleanup();this._oAttachmentsContainer.addItem(this._createNewUploadCollectionInstance(A));}.bind(this)});}}}else{this._oAttachmentsContainer.addItem(this._createNewUploadCollectionInstance(A));}},_createNewUploadSetInstance:function(A){var i=new sap.m.upload.UploadSet("AttachmentCollection",{visible:true,fileTypes:this._getSupportedFileTypeFromAbsenceType(A),maxFileSize:this._getMaxFileSizeFromAbsenceTypeInMB(A),instantUpload:false,showIcons:true,terminationEnabled:false,uploadEnabled:{formatter:f.isAttachmentUploadEnabled,parts:["StartDate","AbsenceTypeCode","create>/isAttachmentUploadEnabled"]},items:{path:"create>/attachments",templateShareable:false,template:new sap.m.upload.UploadSetItem({enabledEdit:true,enabledRemove:true,fileName:"{create>FileName}",url:{parts:["EmployeeID","RequestID","create>ArchivDocId","create>FileName"],formatter:f.formatAttachmentUrl},visibleEdit:false,visibleRemove:true,attributes:[new k({title:"{i18n>attachmentUploadOnTxt}",text:{parts:['create>CreaDate','create>CreaTime'],formatter:f.formatAttachmentTimeStamp}}),new k({title:"{i18n>attachmentFileSizeTxt}",text:{path:"create>FileSize",formatter:f.formatFileSize}})]})},toolbar:new O("attachmentToolbar",{design:sap.m.ToolbarDesign.Transparent,content:[new T({text:"{create>/sAttachmentsTitle}",level:"H2"}),new j()]}),beforeItemAdded:this.onBeforeAttachmentItemAdded.bind(this),afterItemAdded:this.onAfterAttachmentItemAdded.bind(this),fileSizeExceeded:this.onFileSizeExceeded.bind(this),fileTypeMismatch:this.onFileTypeMissmatch.bind(this),beforeUploadStarts:this.onBeforeUploadStartsSet.bind(this)});i.addEventDelegate({onAfterRendering:function(p){this._revalidateUploadButtonStatus();this._revalidateSaveButtonStatus();}.bind(this)});this.oUploadSet=i;return i;},_getSupportedFileTypeFromAbsenceType:function(A){return A.AttachRestrictFileType?A.AttachSupportFileType.toLowerCase().split(','):[];},_getMaxFileSizeFromAbsenceTypeInMB:function(A){return A.AttachMaxSize/1024;},_getFileTypeFromFileName:function(i){return i.substring(i.lastIndexOf('.')+1,i.length)||i;},_createNewUploadCollectionInstance:function(A){var i=new U("AttachmentCollection",{visible:true,fileType:this._getSupportedFileTypeFromAbsenceType(A),maximumFileSize:this._getMaxFileSizeFromAbsenceTypeInMB(A),multiple:false,sameFilenameAllowed:false,showSeparators:sap.m.ListSeparators.All,uploadEnabled:true,instantUpload:false,mode:sap.m.ListMode.None,uploadButtonInvisible:{formatter:f.isAttachmentUploadDisabled,parts:["StartDate","AbsenceTypeCode","create>/isAttachmentUploadEnabled"]},terminationEnabled:false,items:{path:"create>/attachments",templateShareable:false,template:new l({fileName:"{create>FileName}",url:{parts:["EmployeeID","RequestID","create>ArchivDocId","create>FileName"],formatter:f.formatAttachmentUrl},visibleDelete:true,visibleEdit:false,attributes:[new k({title:"{i18n>attachmentUploadOnTxt}",text:{parts:['create>CreaDate','create>CreaTime'],formatter:f.formatAttachmentTimeStamp}}),new k({title:"{i18n>attachmentFileSizeTxt}",text:{path:"create>FileSize",formatter:f.formatFileSize}})]})},infoToolbar:new O("attachmentToolbar",{visible:"{= !( ${create>/uploadPercentage} === 0 || ${create>/uploadPercentage} >= 100 ) }",design:sap.m.ToolbarDesign.Transparent,content:[new L({text:"{i18n>txtUploading}"}),new j(),new P({percentValue:"{create>/uploadPercentage}",showValue:false,state:"None"}).addStyleClass("sapUiSmallMarginBottom")]}),change:this.onAttachmentChange.bind(this),fileSizeExceed:this.onFileSizeExceeded.bind(this),typeMissmatch:this.onFileTypeMissmatch.bind(this),beforeUploadStarts:this.onBeforeUploadStarts.bind(this)});i.addEventDelegate({onAfterRendering:function(){this._revalidateUploadButtonStatus();this._revalidateSaveButtonStatus();}.bind(this)});this.oUploadCollection=i;return i;},_isNewUploadCollectionInstanceNeeded:function(i,A){var p=this._getSupportedFileTypeFromAbsenceType(A),G=this._getMaxFileSizeFromAbsenceTypeInMB(A);return!(i&&(i.getFileType()[0]!==p[0]||i.getMaximumFileSize()!==G));},_informEnduserAboutLostAttachments:function(){var i=this.oUploadCollection.getItems(),p=[];if(i&&i.length>0){p=i.filter(function(A){return A._status!=="display";});return p.length>0;}return false;},_revalidateUploadButtonStatus:function(){var i=[];if(this.oCreateModel.getProperty("/sEditMode")!=="CREATE"){i=this._getAttachmentsFromModel(this.getView().getBindingContext().getObject());}if(this.oUploadCollection){var p=this.oUploadCollection.getItems().filter(function(K){return!i.some(function(N){return N.FileName===K.getProperty("fileName");});});i=i.concat(p);}else if(this.oUploadSet){var A=this.oUploadSet.getIncompleteItems(),G=this.oUploadSet.getItems().concat(A);this.oCreateModel.setProperty("/sAttachmentsTitle",this.getResourceBundle().getText("attachmentToolbarTitle",[G.length]));i=i.concat(A);}this.oCreateModel.setProperty("/isAttachmentUploadEnabled",i.length<x);},_handleApprovers:function(p,A){var G="",K=[];for(var i=0;i<w;i++){G=p+"/ApproverLvl"+(i+1);if(i<A.length){K.push(A[i]);this.oODataModel.setProperty(G+"/Name",A[i].Name);this.oODataModel.setProperty(G+"/Pernr",A[i].Pernr);this.oODataModel.setProperty(G+"/Seqnr",A[i].Seqnr);this.oODataModel.setProperty(G+"/DefaultFlag",A[i].DefaultFlag);}else if(this.oODataModel.getProperty(G)){this.oODataModel.setProperty(G,{Name:"",Pernr:"00000000",Seqnr:"000",DefaultFlag:false});}};this.oCreateModel.setProperty("/iCurrentApproverLevel",A.length);this.oCreateModel.setProperty("/aProposedApprovers",K);},_getAdditionalFieldDefaultValue:function(A){var i="";switch(A.Type_Kind){case"T":i=null;break;case"D":i=null;break;case"C":i=this._isFieldShownAsCheckbox(A)?false:"";break;default:i="";}return i;},_fillAdditionalFieldTexts:function(A,p){A.forEach(function(G){var K,N;N=this.oODataModel.getObject("/"+G);if(N.HasF4&&N.F4EntityName&&p.hasOwnProperty(N.Fieldname)&&(p[N.Fieldname]||N.F4EntityName==="SearchOTCompensationTypeSet")){K=p[N.Fieldname];var Q={},R=this.oODataModel.getMetaModel().getODataEntitySet(N.F4EntityName),V=this.oODataModel.getMetaModel().getODataEntityType(R.entityType).key.propertyRef,W=this.getModel("global").getProperty("/sCountryGrouping");if((N.F4EntityName==="SearchWageTypeSet"&&W)||N.F4EntityName!=="SearchWageTypeSet"){V.forEach(function(i){Q[i.name]="";if(i.name===N.F4KeyProperty){Q[i.name]=K;}if(i.name==="CountryGrouping"&&W){Q[i.name]=W;}}.bind(this));var X=this.oODataModel.createKey("/"+N.F4EntityName,Q),Y=this.oCreateModel.getProperty("/AdditionalFields");this.oODataModel.read(X,{success:function(Z){var $=false;$=Y.some(function(_,i){if(_.Fieldname===N.Fieldname){this.oCreateModel.setProperty("/AdditionalFields/"+i+"/descriptionText",Z[N.F4DescriptionProperty]);_.descriptionText=Z[N.F4DescriptionProperty];return true;}return false;}.bind(this));if($){this._updateChangeRelevantLocalModelProperty("AdditionalFields",Y);}}.bind(this),error:function(i){}});}}}.bind(this));},_getAdditionalFieldValues:function(A,V){var i={};A.forEach(function(p){var G,K;K=this.oODataModel.getObject("/"+p);if(V.hasOwnProperty(K.Fieldname)){if(K.Fieldname.startsWith("CUSTOMER")){switch(K.Type_Kind){case"D":var N=n.getDateInstance({pattern:"yyyyMMdd",UTC:true});G=N.parse(V[K.Fieldname]);break;case"C":G=V[K.Fieldname];if(this._isCustomerAdditionalFieldCheckbox(K)){G=G==='X';}break;default:G=V[K.Fieldname];}}else{G=V[K.Fieldname];}}else{G=this._getAdditionalFieldDefaultValue(K);}i[K.Fieldname]=G;}.bind(this));return i;},_getCurrentAdditionalFieldValues:function(){var i={};this.oCreateModel.getProperty("/AdditionalFields").forEach(function(p){i[p.Fieldname]=p.fieldValue;});return i;},_fillAdditionalFields:function(i,A,p){p.removeAllContent();var G=this.getView().getBindingContext().getPath();i.getProperty("/AdditionalFields").forEach(function(K,N){var Q=this._getAdditionalFieldFragmentName(K,G);if(!this._oAdditionalFieldsControls[K.Fieldname]){if(Q){this._oAdditionalFieldsControls[K.Fieldname]=sap.ui.xmlfragment(this.getView().getId()+K.Fieldname,"hcm.fab.myleaverequest.view.fragments."+Q,this);}else{this._addAdditionalFieldDecimal(this.getView(),p,i,N,this.onNumberChange,K,this._oAdditionalFieldsControls);}}this._oAdditionalFieldsControls[K.Fieldname].forEach(function(R){R.setBindingContext(i.createBindingContext("/AdditionalFields/"+N),"create");if(K.Required){R.setFieldGroupIds("LeaveRequiredField");}this.getView().addDependent(R);p.addContent(R);}.bind(this));}.bind(this));},_addAdditionalFieldDecimal:function(V,i,p,A,N,G,K){var Q=V.getId()+G.Fieldname+"addFieldInputDecimal";var R=new L(Q+"Label",{required:"{create>Required}",text:"{create>FieldLabel}"});R.setBindingContext(p.createBindingContext("/AdditionalFields/"+A),"create");V.addDependent(R);i.addContent(R);var W=new I(Q,{type:"Text",change:N,textAlign:"Right",editable:this.oCreateModel.getProperty("/sEditMode")!=="DELETE",enabled:"{ parts: [{ path: 'create>Readonly' }, { path: 'StartDate' }, { path: 'AbsenceTypeCode' }], formatter: 'hcm.fab.myleaverequest.utils.formatters.isAdditionalFieldEnabled' }"});W.setBindingContext(p.createBindingContext("/AdditionalFields/"+A),"create");W.bindValue({path:"create>fieldValue",type:new d({parseAsString:true,decimals:parseInt(G.Decimals,10),maxIntegerDigits:(parseInt(G.Length,10)-parseInt(G.Decimals,10)),minFractionDigits:0,maxFractionDigits:parseInt(G.Decimals,10)},{precision:parseInt(G.Length,10),scale:parseInt(G.Decimals,10)})});V.addDependent(W);i.addContent(W);if(!K[G.Fieldname]){K[G.Fieldname]=[];K[G.Fieldname].push(R);K[G.Fieldname].push(W);}},_copyAdditionalFieldsIntoModel:function(A,i,p){A.forEach(function(G){var K=G.fieldValue,N=null;switch(G.Type_Kind){case"C":if(!this._bCheckboxFieldsAreBoolean&&typeof K==="boolean"||this._isCustomerAdditionalFieldCheckbox(G)){K=K?"X":"";}break;case"N":K=K+"";break;case"P":if(typeof K==="string"&&K===""){K=null;}break;case"D":if(G.Fieldname.startsWith("CUSTOMER")){N=n.getDateInstance({pattern:"yyyyMMdd"});K=N.format(K);}break;default:}i.setProperty(p+"/AdditionalFields/"+G.Fieldname,K);}.bind(this));},_requiredAdditionalFieldsAreFilled:function(){var i=true,p=false,R=this.byId("additionalFieldsSimpleForm").getControlsByFieldGroupId("LeaveRequiredField");R.forEach(function(A){p=this._checkRequiredField(A);if(!p){i=false;}}.bind(this));return i;},_checkRequiredField:function(i){if(i.getRequired&&i.getRequired()&&i.getValue){var p=sap.ui.getCore().getMessageManager();if(i.getValue()){var A=i.getId()+"-message",G=p.getMessageModel().getData(),K=G.filter(function(R){return R.getId()===A;});if(K.length>0){if(G.length===1){this.oCreateModel.setProperty("/saveButtonEnabled",true);}p.removeMessages(K[0]);}return true;}else{var N=this.getResourceBundle().getText("additionalFieldRequired",i.getParent().getLabel().getText()),Q=i.getBinding("value");this.oCreateModel.setProperty("/saveButtonEnabled",false);p.addMessages(new sap.ui.core.message.Message({id:i.getId()+"-message",message:N,type:sap.ui.core.MessageType.Error,target:(Q.getContext()?Q.getContext().getPath()+"/":"")+Q.getPath(),processor:Q.getModel()}));return false;}}return true;},_checkFormFieldsForError:function(){var i=["additionalFieldsSimpleForm","generalDataForm","leaveTypeSelectionForm"],p=[];return i.some(function(A){p=this.byId(A).getContent();if(p&&p.length>0){return p.some(function(G){return G.getValueState&&G.getValueState()===sap.ui.core.ValueState.Error;});}return false;}.bind(this));},_getAdditionalFieldMetaInfo:function(i){var p=this.oODataModel.getServiceMetadata().dataServices.schema[0].namespace,A=this.oODataModel.getMetaModel().getODataComplexType(p+".AdditionalFields").property,G=A.filter(function(K){return K.name===i;});return G.length>0?G[0]:{};},_getLeaveSpanDateFieldMetaInfo:function(i){var p=this.oODataModel.getMetaModel().getODataFunctionImport("CalculateLeaveSpan").parameter,A=p.filter(function(G){return G.name===i;});return A.length>0?A[0]:{};},_quotaAvailabilityFIHasDateParams:function(){var i=this.oODataModel.getMetaModel().getODataFunctionImport("CalculateQuotaAvailable").parameter;return i.filter(function(p){return p.name==="StartDate";}).length>0;},_isAdditionalFieldBoolean:function(i){return this._getAdditionalFieldMetaInfo(i).type==="Edm.Boolean";},_isCustomerAdditionalFieldCheckbox:function(A){if(A.Fieldname.startsWith("CUSTOMER")){return parseInt(A.Length,10)===1;}return false;},_isFieldShownAsCheckbox:function(A){return this._isAdditionalFieldBoolean(A.Fieldname)||this._isCustomerAdditionalFieldCheckbox(A);},_checkForSearchApproverPropertyExistence:function(){var i=this.oODataModel.getServiceMetadata().dataServices.schema[0].namespace,p=this.oODataModel.getMetaModel().getODataEntityType(i+".SearchApprover");if(p){return p.property.some(function(A){return A.name==="EmployeeID";});}return false;},_getApproverSearchFilters:function(){return this._bApproverOnBehalfPropertyExists?[new F("EmployeeID",b.EQ,this.getModel("global").getProperty("/sEmployeeNumber"))]:[];},_getAdditionalFields:function(A){var i={},p={};return A.definition.map(function(G){p=this.oODataModel.getObject("/"+G);p.fieldValue=A.values[p.Fieldname];p.descriptionText="";if(p.HasF4&&!p.hasOwnProperty("F4KeyProperty")){i=z[p.Fieldname];if(i){p.F4KeyProperty=i.keyField;p.F4TitleProperty=i.titleField;p.F4DescriptionProperty=i.descriptionField;p.F4SearchFilter=i.searchFields;}}return p;}.bind(this));},_getInitialRadioGroupIndex:function(A,i,p){var G=0;if(!f.isMoreThanOneDayAllowed(A.IsAllowedDurationMultipleDay)||(f.isOneDayOrLessAllowed(A.IsAllowedDurationPartialDay,A.IsAllowedDurationSingleDay)&&i&&p&&i.getTime()===p.getTime())){G=1;}return G;},_updateLocalModel:function(A,i,p,G){this.setModelProperties(this.oCreateModel,{"multiOrSingleDayRadioGroupIndex":this._getInitialRadioGroupIndex(i,p,G),"isAttachmentMandatory":i.AttachmentMandatory,"isQuotaCalculated":i.IsQuotaUsed,"BalanceAvailableQuantityText":this.getResourceBundle().getText("availabilityCalculation"),"AllowedDurationMultipleDayInd":i.IsAllowedDurationMultipleDay,"AllowedDurationPartialDayInd":i.IsAllowedDurationPartialDay,"AllowedDurationSingleDayInd":i.IsAllowedDurationSingleDay,"AdditionalFields":this._getAdditionalFields(A),"IsMultiLevelApproval":i.IsMultiLevelApproval,"iMaxApproverLevel":i.ApproverLevel,"isApproverEditable":!i.IsApproverReadOnly,"isApproverVisible":i.IsApproverVisible,"isAddDeleteApproverAllowed":i.AddDelApprovers,"isNoteVisible":i.IsNoteVisible,"showTimePicker":i.IsRecordInClockTimesAllowed&&i.IsAllowedDurationPartialDay,"showInputHours":i.IsRecordInClockHoursAllowed&&i.IsAllowedDurationPartialDay,"AbsenceDescription":i.AbsenceDescription?i.AbsenceDescription:null,"AbsenceTypeName":i.AbsenceTypeName,"oLeaveStartDate":q.convertToLocal(p),"oLeaveEndDate":q.convertToLocal(G)});if(i.IsQuotaUsed){this._updateAvailableQuota(i,p,G);}},_updateLeaveRequestWithModifiedAttachments:function(i,p){var A=i.getProperty(p);var G=Array.apply(null,{length:x}).map(function(Q,R){return A["Attachment"+(R+1)];}).filter(function(Q){return Q&&Q.FileName!=="";});var K=[],N=false;if(this.oUploadCollection){K=this.oUploadCollection.getItems();}else if(this.oUploadSet){K=this.oUploadSet.getItems();}G.forEach(function(Q,R){N=K.some(function(V){return V.getProperty("fileName")===Q.FileName;});if(!N){this.oODataModel.setProperty(p+"/Attachment"+(R+1)+"/AttachmentStatus","D");}}.bind(this));if(this.oUploadSet){K=this.oUploadSet.getIncompleteItems();}K.forEach(function(Q,R){var V;if(Q.getFileObject){V=Q.getFileObject();}else{V=this._oNewFileData[Q.getFileName()];}if(V){var W=p+"/Attachment"+(G.length+1),X=Math.ceil(V.size/1024);this.oODataModel.setProperty(W+"/FileName",Q.getFileName());this.oODataModel.setProperty(W+"/FileType",V.type);this.oODataModel.setProperty(W+"/FileSize",X.toString());}}.bind(this));},_showSuccessStatusMessage:function(p){u.navTo.call(this,"overview");this.oCreateModel.setProperty("/busy",false);this.getOwnerComponent().getEventBus().publish("hcm.fab.myleaverequest","invalidateoverview",{fnAfterNavigate:function(){if(p.showSuccess){jQuery.sap.delayedCall(400,this,function(){g.show(this.getResourceBundle().getText("createdSuccessfully"));});}}.bind(this)});this.initLocalModel();this.getView().setBindingContext(null);this._doAttachmentCleanup();return Promise.resolve(p);},_doAttachmentCleanup:function(i){this._oAttachmentsContainer.destroyItems();this.oUploadCollection=null;this.oUploadSet=null;this._oNewFileData={};},_uploadAttachments:function(p){return new Promise(function(R,i){if(this.oUploadCollection){this._uploadAttachmentsUploadCollection(R,i,p);}else if(this.oUploadSet){this._uploadAttachmentsUploadSet(R,i,p);}else{R(p);}}.bind(this));},_uploadAttachmentsUploadSet:function(R,i,p){var A=this.oUploadSet.getIncompleteItems(),G=null,K=0,N=A.length;if(A.length===0){R(p);return;}var Q=jQuery.extend({},this.getView().getBindingContext().getObject());if(p.requestID&&p.requestID!==Q.RequestID){Q.RequestID=p.requestID;}var V=this._getAttachmentsUploadUrl(this.oODataModel.createKey("/LeaveRequestSet",Q));this.oUploadSet.setUploadUrl(V);A.forEach(function(X){X.setUrl(V);});var W=function(X){var Y=X.getParameter("item");K++;var Z=(K/N*100);p.aUploadedFiles.push({FileName:Y.getFileObject().fileName});if(Z>=100){this.oUploadSet.detachUploadCompleted(W);R(p);}else{G=A.shift();this.oUploadSet.uploadItem(G);}}.bind(this);this.oUploadSet.attachUploadCompleted(W);G=A.shift();this.oUploadSet.uploadItem(G);},_uploadAttachmentsUploadCollection:function(R,i,p){var A=this.oUploadCollection.getItems(),G=0,K=0;A.forEach(function(X){if(X._status!=="display"){K++;}});if(K===0){R(p);return;}var N=jQuery.extend({},this.getView().getBindingContext().getObject());if(p.requestID){N.RequestID=p.requestID;}var Q=this.oODataModel.createKey("/LeaveRequestSet",N),V=this._getAttachmentsUploadUrl(Q);this._updateUploadUrlsUploadCollection(A,V);this.oCreateModel.setProperty("/uploadPercentage",5);var W=function(X){X.getParameter("files").forEach(function(Y){if(parseInt(Y.status,10)>=400){var Z=jQuery.parseXML(Y.responseRaw),$=u.convertXML2JSON(Z.documentElement);h.warning(this.getResourceBundle().getText("txtUploadError",[Y.fileName]),{title:this.getResourceBundle().getText("txtUploadErrorTitle"),details:$.message,onClose:function(){p.showSuccess=false;R(p);}});}else{G++;var _=(G/K*100);this.oCreateModel.setProperty("/uploadPercentage",_);p.aUploadedFiles.push({FileName:Y.fileName});if(_>=100){R(p);}}}.bind(this));this.oUploadCollection.detachUploadComplete(W);}.bind(this);this.oUploadCollection.attachUploadComplete(W,this);this.oUploadCollection.upload();},_initOverlapCalendar:function(){if(!this._oOverlapCalendar){this.oCreateModel.setProperty("/calendar/overlapNumber",0);this._oOverlapCalendar=new o({id:"overlapTeamCalendar",applicationId:"MYLEAVEREQUESTS",instanceId:"OVERLAP",assignmentId:"{global>/sEmployeeNumber}",requesterId:"{global>/sEmployeeNumber}",startDate:"{StartDate}",leaveRequestMode:true,leaveRequestSimulateRequest:true,leaveRequestStartDate:"{StartDate}",leaveRequestEndDate:"{EndDate}",leaveRequestDescription:"{create>/calendarOverlapLeaveRequestText}",showConcurrentEmploymentButton:false,visible:"{create>/calendar/opened}",dataChanged:function(i){this.oCreateModel.setProperty("/calendar/overlapNumber",i.getParameter("employeeConflictList").length);}.bind(this)});this.getView().addDependent(this._oOverlapCalendar);if(this._oOverlapCalendar.getMetadata().hasProperty("dataChangedDate")){this._oOverlapCalendar.bindProperty("dataChangedDate",{path:"/lastLeaveRequestChangeDate",model:"global",mode:"OneWay"});}}this.oCreateModel.setProperty("/calendarOverlapLeaveRequestText",this.getResourceBundle().getText(this.oCreateModel.getProperty("/sEditMode")==="EDIT"?"calendarOverlapLeaveRequestEditText":"calendarOverlapLeaveRequestText"));},_showBusyDialog:function(i){var p=this.getModel("global").getProperty("/bShowBusyIndicatorForFunctionImports");if(p){this.byId("busyDialog").open();if(i){this._oControlToFocus=i;}}},_closeBusyDialog:function(){var i=this.getModel("global").getProperty("/bShowBusyIndicatorForFunctionImports");if(i){this.byId("busyDialog").close();if(this._oControlToFocus){this._oControlToFocus.focus();this._oControlToFocus=null;}}},_convertHoursMinutesFromDateToDecimal:function(i){var p=i;if(!p){p=new Date(0,0);}return parseFloat((p.getHours()+((1/60)*p.getMinutes())),10);},_getDecimalHoursFromTimepicker:function(){return this._convertHoursMinutesFromDateToDecimal(this.byId("traditionalHoursPicker").getDateValue());},_getDecimalHoursFromInputControl:function(){var i=this.byId("hoursValue");return parseFloat(i.getValue());}});});
