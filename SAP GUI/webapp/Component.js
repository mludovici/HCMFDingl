/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/UIComponent","sap/ui/core/routing/HashChanger","hcm/fab/lib/common/util/CommonModelManager","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","hcm/fab/myleaverequest/model/models","hcm/fab/myleaverequest/controller/ErrorHandler","hcm/fab/myleaverequest/utils/utils"],function(U,H,C,D,J,F,a,m,E,u){"use strict";return U.extend("hcm.fab.myleaverequest.Component",{metadata:{manifest:"json"},oMessageProcessor:null,oMessageManager:null,sEmployeeId:undefined,init:function(){U.prototype.init.apply(this,arguments);this.oMessageProcessor=new sap.ui.core.message.ControlMessageProcessor();this.oMessageManager=sap.ui.getCore().getMessageManager();this.oMessageManager.registerMessageProcessor(this.oMessageProcessor);this._oErrorHandler=new E(this,this.oMessageProcessor,this.oMessageManager);this.setModel(m.createDeviceModel(),"device");this.setModel(this.oMessageManager.getMessageModel(),"message");this.getRouter().initialize();var s=this.getStartupParameters();if(s.action&&!this.hasInnerAppRoute()){this.navigateToView(s);}this.setModel(new J({lastLeaveRequestChangeDate:undefined,leaveRequestMinDisplayDate:undefined,defaultFilterDate:undefined,isAssignmentLoading:true,isConfigLoading:false,sCountryGrouping:null,sEmployeeNumber:null,showEmployeeNumber:false,showEmployeePicture:false,bShowEmployeeNumberWithoutZeros:false,bEditRequestBeforeDeletion:false,bShowBusyIndicatorForFunctionImports:false,bShowIndustryHours:true,bReloadApproversUponDateChange:false}),"global");},hasInnerAppRoute:function(){var o=sap.ushell.Container.getService("URLParsing"),h=H.prototype.getHash(),p=o.parseShellHash(h);return typeof p.appSpecificRoute==="string"&&p.appSpecificRoute.length>0;},navigateToView:function(s){var A={"create":"creationWithParams"},t=A[s.action];if(!t){return;}this.getRouter().navTo(t,{absenceType:s.absenceType||"default",dateFrom:s.dateFrom||0,dateTo:s.dateTo||0});},getStartupParameters:function(){if(!this.getComponentData()){return{};}var A=this.getComponentData().startupParameters,s={};Object.keys(A).forEach(function(p){s[p]=A[p][0];});return s;},destroy:function(){this.getErrorHandler().destroy();U.prototype.destroy.apply(this,arguments);},getContentDensityClass:function(){if(this._sContentDensityClass===undefined){if(jQuery(document.body).hasClass("sapUiSizeCozy")||jQuery(document.body).hasClass("sapUiSizeCompact")){this._sContentDensityClass="";}else if(!D.support.touch){this._sContentDensityClass="sapUiSizeCompact";}else{this._sContentDensityClass="sapUiSizeCozy";}}return this._sContentDensityClass;},getErrorHandler:function(){return this._oErrorHandler;},getAssignmentPromise:function(n){var g=this.getModel("global"),e=g.getProperty("/sEmployeeNumber"),A=function(o){g.setProperty("/sEmployeeNumber",o.EmployeeId);g.setProperty("/showEmployeeNumber",o.ShowEmployeeNumber);g.setProperty("/showEmployeePicture",o.ShowEmployeePicture);g.setProperty("/bShowEmployeeNumberWithoutZeros",o.ShowEmployeeNumberWithoutZeros);g.setProperty("/isConfigLoading",true);return this._readConfigurationSet(o.EmployeeId).then(function(){g.setProperty("/isConfigLoading",false);g.setProperty("/isAssignmentLoading",false);return o.EmployeeId;}.bind(this));}.bind(this),s=this.getStartupParameters();if(s.OnBehalfEmployeeNumber&&s.RequesterNumber){C.setOnBehalfEmployeeId(s.RequesterNumber,s.OnBehalfEmployeeNumber,"MYLEAVEREQUESTS");return C.getAssignmentInformation(s.OnBehalfEmployeeNumber,"MYLEAVEREQUESTS").then(A);}else{if(n){return C.getAssignmentInformation(n,"MYLEAVEREQUESTS").then(A);}if(!e){return C.getDefaultAssignment("MYLEAVEREQUESTS").then(A);}}return Promise.resolve(e);},_readConfigurationSet:function(e){var _=new Promise(function(r,b){var g=this.getModel("global");this.getModel().read("/ConfigurationSet",{filters:[new F("EmployeeID",a.EQ,e)],success:function(R){var o=R.results[0];g.setProperty("/defaultFilterDate",o.DefaultFilterDate);g.setProperty("/leaveRequestMinDisplayDate",o.MinDisplayDate);if(o.hasOwnProperty("CountryGrouping")){g.setProperty("/sCountryGrouping",o.CountryGrouping);}if(o.hasOwnProperty("EditRequestBeforeDeletion")){g.setProperty("/bEditRequestBeforeDeletion",o.EditRequestBeforeDeletion);}if(o.hasOwnProperty("ShowBusyIndicatorForFunctionImports")){g.setProperty("/bShowBusyIndicatorForFunctionImports",o.ShowBusyIndicatorForFunctionImports);}if(o.hasOwnProperty("ShowDurationIndustrialHours")){g.setProperty("/bShowIndustryHours",o.ShowDurationIndustrialHours);}if(o.hasOwnProperty("ReloadApproversUponDateChange")){g.setProperty("/bReloadApproversUponDateChange",o.ReloadApproversUponDateChange);}r();}.bind(this),error:function(o){g.setProperty("/leaveRequestMinDisplayDate",u.dateToLocal(new Date(Date.UTC(new Date().getFullYear(),null,1))));b(o);}.bind(this)});}.bind(this));return _;}});});
